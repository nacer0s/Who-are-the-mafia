{% extends "base.html" %}

{% block title %}سياسة الخصوصية - لعبة المافيا{% endblock %}

{% block body_class %}legal-page privacy-page{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header -->
            <div class="text-center mb-5">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-shield-alt text-success"></i>
                    سياسة الخصوصية
                </h1>
                <p class="lead text-muted">
                    نحن ملتزمون بحماية خصوصيتك وبياناتك الشخصية
                </p>
                <div class="alert alert-success">
                    <small>
                        <i class="fas fa-calendar-alt"></i>
                        آخر تحديث: ديسمبر 2024 | نافذة منذ: يناير 2024
                    </small>
                </div>
            </div>

            <!-- المحتوى -->
            <div class="card shadow-lg">
                <div class="card-body p-5">
                    <h2 class="mb-4">1. مقدمة</h2>
                    <p>
                        تشرح هذه السياسة كيفية جمع واستخدام وحماية معلوماتك الشخصية عند استخدام موقع لعبة المافيا. 
                        نحن نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية وفقاً لأفضل الممارسات والقوانين المعمول بها.
                    </p>

                    <h2 class="mb-4 mt-5">2. المعلومات التي نجمعها</h2>
                    
                    <div class="ps-3">
                        <h5>2.1 المعلومات التي تقدمها بنفسك</h5>
                        <ul>
                            <li><strong>معلومات الحساب:</strong> اسم المستخدم، البريد الإلكتروني، كلمة المرور</li>
                            <li><strong>معلومات الملف الشخصي:</strong> اسم العرض، الصورة الرمزية، الوصف الشخصي</li>
                            <li><strong>محتوى المستخدم:</strong> الرسائل النصية والصوتية في اللعبة</li>
                            <li><strong>معلومات الاتصال:</strong> عند التواصل مع الدعم الفني</li>
                        </ul>

                        <h5>2.2 المعلومات التي نجمعها تلقائياً</h5>
                        <ul>
                            <li><strong>معلومات الجهاز:</strong> نوع المتصفح، نظام التشغيل، عنوان IP</li>
                            <li><strong>معلومات الاستخدام:</strong> صفحات الويب المزارة، وقت الزيارة، مدة الجلسة</li>
                            <li><strong>بيانات اللعبة:</strong> إحصائيات اللعب، النقاط، الإنجازات</li>
                            <li><strong>ملفات تعريف الارتباط:</strong> لتحسين تجربة المستخدم</li>
                        </ul>

                        <h5>2.3 المعلومات من أطراف ثالثة</h5>
                        <ul>
                            <li>معلومات التسجيل عبر وسائل التواصل الاجتماعي (إن وجدت)</li>
                            <li>معلومات الدفع من مقدمي خدمات الدفع (للمشتريات المستقبلية)</li>
                        </ul>
                    </div>

                    <h2 class="mb-4 mt-5">3. كيفية استخدام معلوماتك</h2>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card bg-light h-100">
                                <div class="card-body">
                                    <h6 class="text-primary"><i class="fas fa-gamepad"></i> تشغيل الخدمة</h6>
                                    <ul class="small">
                                        <li>إنشاء وإدارة حسابك</li>
                                        <li>تشغيل الألعاب والدردشة</li>
                                        <li>حفظ تقدمك وإحصائياتك</li>
                                        <li>تخصيص تجربة اللعب</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card bg-light h-100">
                                <div class="card-body">
                                    <h6 class="text-success"><i class="fas fa-shield-alt"></i> الأمان والحماية</h6>
                                    <ul class="small">
                                        <li>كشف الغش والسلوك المشبوه</li>
                                        <li>منع إساءة الاستخدام</li>
                                        <li>حماية اللاعبين الآخرين</li>
                                        <li>التحقق من الهوية</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card bg-light h-100">
                                <div class="card-body">
                                    <h6 class="text-info"><i class="fas fa-chart-line"></i> التحسين والتطوير</h6>
                                    <ul class="small">
                                        <li>تحليل استخدام الموقع</li>
                                        <li>تحسين الأداء والتجربة</li>
                                        <li>تطوير ميزات جديدة</li>
                                        <li>إصلاح الأخطاء</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card bg-light h-100">
                                <div class="card-body">
                                    <h6 class="text-warning"><i class="fas fa-envelope"></i> التواصل</h6>
                                    <ul class="small">
                                        <li>إرسال التحديثات المهمة</li>
                                        <li>الإشعارات الأمنية</li>
                                        <li>الدعم الفني</li>
                                        <li>أخبار اللعبة (اختياري)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 class="mb-4 mt-5">4. الذكاء الاصطناعي ومعالجة البيانات</h2>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-robot"></i> استخدام الذكاء الاصطناعي</h6>
                        <p class="mb-2">نستخدم تقنيات الذكاء الاصطناعي لتحسين تجربة اللعب، وذلك من خلال:</p>
                        <ul class="mb-0">
                            <li><strong>تحليل الرسائل:</strong> لكشف المحتوى المسيء أو محاولات الغش</li>
                            <li><strong>تحليل الصوت:</strong> تحويل الرسائل الصوتية إلى نص (عند الحاجة)</li>
                            <li><strong>تحليل أنماط اللعب:</strong> لكشف السلوك المشبوه</li>
                            <li><strong>التحليلات الشخصية:</strong> لتقديم نصائح وإحصائيات مخصصة</li>
                        </ul>
                    </div>

                    <h2 class="mb-4 mt-5">5. مشاركة المعلومات</h2>
                    
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle"></i> لا نبيع بياناتك الشخصية</h6>
                        <p class="mb-0">
                            نحن لا نبيع أو نؤجر أو نتاجر في معلوماتك الشخصية مع أطراف ثالثة لأغراض تجارية.
                        </p>
                    </div>

                    <p>قد نشارك معلوماتك في الحالات التالية فقط:</p>
                    <ul>
                        <li><strong>مقدمو الخدمات:</strong> شركات تساعدنا في تشغيل الموقع (استضافة، تحليلات)</li>
                        <li><strong>المتطلبات القانونية:</strong> عند الطلب من السلطات المختصة</li>
                        <li><strong>حماية الحقوق:</strong> لحماية حقوقنا أو حقوق المستخدمين الآخرين</li>
                        <li><strong>نقل الملكية:</strong> في حالة بيع أو نقل ملكية الشركة</li>
                    </ul>

                    <h2 class="mb-4 mt-5">6. أمان البيانات</h2>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="security-feature">
                                <div class="security-icon">
                                    <i class="fas fa-lock text-success"></i>
                                </div>
                                <h6>التشفير</h6>
                                <p class="small">جميع البيانات محمية بتشفير SSL/TLS</p>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="security-feature">
                                <div class="security-icon">
                                    <i class="fas fa-server text-primary"></i>
                                </div>
                                <h6>الخوادم الآمنة</h6>
                                <p class="small">خوادم محمية بأحدث تقنيات الأمان</p>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <div class="security-feature">
                                <div class="security-icon">
                                    <i class="fas fa-eye-slash text-warning"></i>
                                </div>
                                <h6>الوصول المحدود</h6>
                                <p class="small">وصول محدود للموظفين المخولين فقط</p>
                            </div>
                        </div>
                    </div>

                    <h2 class="mb-4 mt-5">7. حقوقك</h2>
                    
                    <div class="ps-3">
                        <h5>7.1 الحق في الوصول</h5>
                        <p>يمكنك طلب نسخة من بياناتك الشخصية التي نحتفظ بها.</p>

                        <h5>7.2 الحق في التصحيح</h5>
                        <p>يمكنك طلب تصحيح أو تحديث بياناتك الشخصية غير الدقيقة.</p>

                        <h5>7.3 الحق في الحذف</h5>
                        <p>يمكنك طلب حذف بياناتك الشخصية في ظروف معينة.</p>

                        <h5>7.4 الحق في نقل البيانات</h5>
                        <p>يمكنك طلب نقل بياناتك إلى خدمة أخرى بتنسيق مقروء آلياً.</p>

                        <h5>7.5 الحق في الاعتراض</h5>
                        <p>يمكنك الاعتراض على معالجة بياناتك لأغراض تسويقية.</p>
                    </div>

                    <h2 class="mb-4 mt-5">8. ملفات تعريف الارتباط (Cookies)</h2>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>نوع ملف تعريف الارتباط</th>
                                    <th>الغرض</th>
                                    <th>المدة</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>ضرورية</strong></td>
                                    <td>تشغيل الموقع الأساسي</td>
                                    <td>جلسة المتصفح</td>
                                </tr>
                                <tr>
                                    <td><strong>تحليلية</strong></td>
                                    <td>فهم كيفية استخدام الموقع</td>
                                    <td>سنتان</td>
                                </tr>
                                <tr>
                                    <td><strong>وظيفية</strong></td>
                                    <td>تذكر تفضيلاتك</td>
                                    <td>سنة واحدة</td>
                                </tr>
                                <tr>
                                    <td><strong>تسويقية</strong></td>
                                    <td>عرض محتوى مخصص</td>
                                    <td>30 يوماً</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h2 class="mb-4 mt-5">9. الاحتفاظ بالبيانات</h2>
                    <ul>
                        <li><strong>بيانات الحساب:</strong> طالما كان حسابك نشطاً + 3 سنوات بعد الحذف</li>
                        <li><strong>بيانات اللعبة:</strong> 5 سنوات لأغراض الإحصائيات</li>
                        <li><strong>السجلات الأمنية:</strong> 7 سنوات للامتثال القانوني</li>
                        <li><strong>بيانات الدعم:</strong> 3 سنوات من آخر تفاعل</li>
                    </ul>

                    <h2 class="mb-4 mt-5">10. حماية الأطفال</h2>
                    <div class="alert alert-info">
                        <p class="mb-0">
                            <i class="fas fa-child"></i>
                            <strong>المستخدمون تحت سن 13:</strong> 
                            لا نجمع عمداً معلومات شخصية من الأطفال دون سن 13 عاماً. 
                            إذا علمنا أن طفلاً دون سن 13 قد زودنا بمعلومات شخصية، فسنقوم بحذفها فوراً.
                        </p>
                    </div>

                    <h2 class="mb-4 mt-5">11. التحديثات على هذه السياسة</h2>
                    <p>
                        قد نحدث هذه السياسة من وقت لآخر. سنخطرك بأي تغييرات مهمة عبر:
                    </p>
                    <ul>
                        <li>إشعار بارز في الموقع</li>
                        <li>رسالة بريد إلكتروني (للتغييرات المهمة)</li>
                        <li>إشعار في التطبيق</li>
                    </ul>

                    <h2 class="mb-4 mt-5">12. معلومات الاتصال</h2>
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="mb-3">للأسئلة حول الخصوصية أو لممارسة حقوقك:</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-2"><i class="fas fa-envelope text-primary"></i> <strong>البريد الإلكتروني:</strong></p>
                                    <p class="ms-4">privacy@mafia-game.com</p>
                                    
                                    <p class="mb-2"><i class="fas fa-phone text-success"></i> <strong>الهاتف:</strong></p>
                                    <p class="ms-4">+971-XX-XXXXXXX</p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-2"><i class="fas fa-map-marker-alt text-danger"></i> <strong>العنوان البريدي:</strong></p>
                                    <p class="ms-4">
                                        مسؤول حماية البيانات<br>
                                        لعبة المافيا<br>
                                        دبي، الإمارات العربية المتحدة
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- توقيع قانوني -->
                    <div class="text-center mt-5">
                        <div class="border-top pt-4">
                            <p class="text-muted small">
                                © 2024 لعبة المافيا. جميع الحقوق محفوظة.
                                <br>
                                تم آخر تحديث لهذه السياسة في ديسمبر 2024
                                <br>
                                <strong>التزامنا بخصوصيتك مستمر ومتطور</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- أزرار الإجراءات -->
            <div class="text-center mt-4">
                <div class="btn-group">
                    <a href="{{ url_for('terms') }}" class="btn btn-outline-primary">
                        <i class="fas fa-file-contract"></i> شروط الاستخدام
                    </a>
                    <a href="{{ url_for('profile') }}" class="btn btn-outline-success">
                        <i class="fas fa-cog"></i> إعدادات الخصوصية
                    </a>
                    <a href="{{ url_for('help') }}" class="btn btn-outline-info">
                        <i class="fas fa-question-circle"></i> المساعدة
                    </a>
                    <button onclick="window.print()" class="btn btn-outline-secondary">
                        <i class="fas fa-print"></i> طباعة
                    </button>
                    <button onclick="window.close()" class="btn btn-outline-dark">
                        <i class="fas fa-times"></i> إغلاق
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.privacy-page {
    background: #f8f9fa;
    font-family: 'Arial', 'Tahoma', sans-serif;
}

.privacy-page h1 {
    color: #27ae60;
}

.privacy-page h2 {
    color: #2c3e50;
    border-bottom: 2px solid #27ae60;
    padding-bottom: 0.5rem;
}

.privacy-page h5 {
    color: #16a085;
    margin-top: 1.5rem;
    margin-bottom: 1rem;
}

.privacy-page h6 {
    color: #2980b9;
    font-weight: 600;
}

.privacy-page p {
    line-height: 1.8;
    text-align: justify;
    color: #555;
}

.privacy-page ul, .privacy-page ol {
    line-height: 1.7;
}

.privacy-page li {
    margin-bottom: 0.5rem;
    color: #666;
}

.security-feature {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.security-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
}

.security-feature h6 {
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.table th {
    background: #ecf0f1;
    color: #2c3e50;
    font-weight: 600;
}

.card {
    border: none;
    border-radius: 15px;
}

.alert {
    border-radius: 10px;
}

.btn-group .btn {
    margin: 0 2px;
}

/* إضافة تأثيرات للعناصر التفاعلية */
.security-feature:hover {
    transform: translateY(-3px);
    transition: transform 0.3s ease;
}

.card:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    transition: box-shadow 0.3s ease;
}

/* تحسين الطباعة */
@media print {
    .btn-group,
    .navbar,
    .footer {
        display: none !important;
    }
    
    .card {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }
    
    body {
        background: white !important;
    }
    
    .security-feature {
        box-shadow: none !important;
    }
}

/* تحسين الاستجابة */
@media (max-width: 768px) {
    .container {
        padding: 1rem;
    }
    
    .card-body {
        padding: 2rem 1.5rem !important;
    }
    
    .btn-group {
        flex-direction: column;
    }
    
    .btn-group .btn {
        margin: 2px 0;
        width: 100%;
    }
    
    .table-responsive {
        font-size: 0.9rem;
    }
}

/* تحسين قابلية الوصول */
.alert-info, .alert-warning {
    position: relative;
}

.alert-info::before {
    content: "ℹ️";
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.2rem;
}

.alert-warning::before {
    content: "⚠️";
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.2rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // تمييز الأقسام المهمة عند النقر
    const importantSections = document.querySelectorAll('.alert-info, .alert-warning');
    importantSections.forEach(section => {
        section.addEventListener('click', function() {
            this.style.animation = 'pulse 0.5s';
            setTimeout(() => {
                this.style.animation = '';
            }, 500);
        });
    });
    
    // تأثير التمرير السلس للعناوين
    const headings = document.querySelectorAll('h2');
    headings.forEach(heading => {
        heading.style.cursor = 'pointer';
        heading.addEventListener('click', function() {
            this.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
    });
    
    // إبراز النص المحدد
    document.addEventListener('selectstart', function(e) {
        if (e.target.tagName === 'P' || e.target.tagName === 'LI') {
            e.target.style.backgroundColor = '#e8f5e8';
            setTimeout(() => {
                e.target.style.backgroundColor = '';
            }, 2000);
        }
    });
    
    // تتبع وقت القراءة (للإحصائيات)
    let startTime = Date.now();
    let readingTime = 0;
    
    window.addEventListener('beforeunload', function() {
        readingTime = Math.floor((Date.now() - startTime) / 1000);
        // يمكن إرسال هذه البيانات للتحليلات إذا رغبت
        console.log(`وقت قراءة سياسة الخصوصية: ${readingTime} ثانية`);
    });
    
    // فحص موافقة ملفات تعريف الارتباط
    checkCookieConsent();
});

// فحص موافقة المستخدم على ملفات تعريف الارتباط
function checkCookieConsent() {
    if (!localStorage.getItem('cookieConsent')) {
        // يمكن إضافة بانر موافقة ملفات تعريف الارتباط هنا
        console.log('المستخدم لم يوافق على ملفات تعريف الارتباط بعد');
    }
}

// دالة لطلب حذف البيانات
function requestDataDeletion() {
    if (confirm('هل أنت متأكد من رغبتك في حذف جميع بياناتك؟ هذا الإجراء لا يمكن التراجع عنه.')) {
        // إرسال طلب حذف البيانات
        fetch('/api/privacy/delete-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                confirmation: true
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('تم تسجيل طلب حذف البيانات. سيتم التواصل معك خلال 30 يوماً.');
            } else {
                alert('حدث خطأ في معالجة طلبك. يرجى المحاولة مرة أخرى.');
            }
        })
        .catch(error => {
            console.error('خطأ في طلب حذف البيانات:', error);
        });
    }
}

// دالة لتصدير البيانات الشخصية
function exportPersonalData() {
    // طلب تصدير البيانات
    fetch('/api/privacy/export-data', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('سيتم إرسال ملف بياناتك الشخصية إلى بريدك الإلكتروني خلال 48 ساعة.');
        } else {
            alert('حدث خطأ في معالجة طلبك. يرجى المحاولة مرة أخرى.');
        }
    })
    .catch(error => {
        console.error('خطأ في طلب تصدير البيانات:', error);
    });
}
</script>
{% endblock %}